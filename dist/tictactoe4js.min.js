"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Board=function(){function e(t){var r=t.size;_classCallCheck(this,e),this.board=[],this.size=r;for(var i=parseInt(r),n=0;n<i;n++){this.board.push([]);for(var o=0;o<i;o++)this.board[n].push(" ")}}return _createClass(e,[{key:"placePiece",value:function(e){var t=e.player,r=e.position,i=this.getCoordinatePos({position:r});return!(!i||""!==this.board[i.x][i.y].trim()||(this.board[i.x][i.y]=t,0))}},{key:"getCoordinatePos",value:function(e){for(var t=e.position-1,r=0,i=0;i<this.size;i++)for(var n=0;n<this.size;n++)if(t===r++)return{x:i,y:n};return null}},{key:"getNormalizedPos",value:function(e){for(var t=e.x,r=e.y,i=0,n=0;n<this.size;n++)for(var o=0;o<this.size;o++)if(i++,n==t&&o==r)return i;return null}},{key:"getEmptySpots",value:function(){for(var e=[],t=0,r=0;r<this.size;r++)for(var i=0;i<this.size;i++)t++,""==this.board[r][i].trim()&&e.push(t);return e}},{key:"print",value:function(){console.log(this.board)}}]),e}();const src_Board=Board;var WLD=Object.freeze({WIN:"WIN",LOSS:"LOSS",DRAW:"DRAW"}),GameState=Object.freeze({RUNNING:"RUNNING",PAUSED:"PAUSED",ENDED:"ENDED"}),GamePiece=Object.freeze({X:"X",O:"O"}),Difficulty=Object.freeze({BEGINNER:"BEGINNER",INTERMEDIATE:"INTERMEDIATE",EXPERT:"EXPERT"});function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Umpire_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Umpire_defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Umpire_createClass(e,t,r){return t&&Umpire_defineProperties(e.prototype,t),r&&Umpire_defineProperties(e,r),e}var Umpire=function(){function e(){Umpire_classCallCheck(this,e),this.moves=0}return Umpire_createClass(e,[{key:"getDecision",value:function(e){var t=e.board,r=e.player,i=e.position;this.moves++;var n=_toConsumableArray(t.board),o=t.size,a=t.getCoordinatePos({position:i}),s=null,c=[];if(this.moves===Math.pow(o,2))return{verdict:WLD.DRAW,winner:s,winSlots:c};for(var l=0;l<o&&n[a.x][l]===r;l++)if(c.push(t.getNormalizedPos({x:a.x,y:l})),l==o-1)return{verdict:(s=r)===r?WLD.WIN:WLD.LOSS,winner:s,winSlots:c};c=[];for(var u=0;u<o&&n[u][a.y]===r;u++)if(c.push(t.getNormalizedPos({x:u,y:a.y})),u==o-1)return{verdict:(s=r)===r?WLD.WIN:WLD.LOSS,winner:s,winSlots:c};if(c=[],a.x===a.y)for(var f=0;f<o&&n[f][f]===r;f++)if(c.push(t.getNormalizedPos({x:f,y:f})),f==o-1)return{verdict:(s=r)===r?WLD.WIN:WLD.LOSS,winner:s,winSlots:c};if(c=[],a.x+a.y===o-1)for(var p=0;p<o&&n[p][o-1-p]===r;p++)if(c.push(t.getNormalizedPos({x:p,y:o-1-p})),p==o-1)return{verdict:(s=r)===r?WLD.WIN:WLD.LOSS,winner:s,winSlots:c};return c=[],{verdict:null,winner:null,winSlots:null}}}]),e}();const src_Umpire=Umpire;function Player_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Player=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Player_classCallCheck(this,e),this.id=t,this.name=r,this.difficulty=i};const src_Player=Player;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function AIBrain_defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function AIBrain_createClass(e,t,r){return t&&AIBrain_defineProperties(e.prototype,t),r&&AIBrain_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,i=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function AIBrain_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Move=function e(t){var r=t.score,i=t.point;AIBrain_classCallCheck(this,e),this.score=r,this.point=i},AIBrain=function(e){_inherits(r,src_Player);var t=_createSuper(r);function r(){return AIBrain_classCallCheck(this,r),t.apply(this,arguments)}return AIBrain_createClass(r,[{key:"getMove",value:function(e){var t=e.board;switch(e.aiPiece,e.aiDifficulty){case Difficulty.BEGINNER:return this.getBeginnerAIMove(t)}}},{key:"getBeginnerAIMove",value:function(e){var t=e.getEmptySpots();return t[Math.floor(Math.random()*Math.floor(t.length))]}}]),r}();const src_AIBrain=AIBrain;function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TicTacToe_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function TicTacToe_defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function TicTacToe_createClass(e,t,r){return t&&TicTacToe_defineProperties(e.prototype,t),r&&TicTacToe_defineProperties(e,r),e}var TicTacToe=function(){function e(t){var r=t.size,i=t.turnTimeLimit,n=t.gameTimeLimit,o=t.startPiece;TicTacToe_classCallCheck(this,e),this.size=r,this.turnTimeLimit=this.timeSToMs(i),this.gameTimeLimit=this.timeSToMs(n),this.playList=[],this.nextTurnPiece=o||GamePiece.X,this.board=new src_Board({size:r}),this.umpire=new src_Umpire,this.aiBrain=new src_AIBrain,this.gameState=GameState.ENDED,this.gameTimer=null,this.turnTimer=null,this.gameTimeElapsed=0,this.turnTimeElapsed=0,this.onStart()}return TicTacToe_createClass(e,[{key:"onStart",value:function(){var e=this;this.gameState=GameState.RUNNING,this.gameTimer=setInterval((function(){if(e.gameTimeElapsed>=e.gameTimeLimit){var t=e.nextTurnPiece===GamePiece.X?GamePiece.O:GamePiece.X;e.onEnd({isValid:!1,winner:t,message:"Game time limit reached"})}else e.onTick(),e.gameTimeElapsed+=1e3}),1e3),this.turnTimer=setInterval((function(){if(e.turnTimeElapsed>=e.turnTimeLimit){var t=e.nextTurnPiece===GamePiece.X?GamePiece.O:GamePiece.X;e.onEnd({isValid:!1,winner:t,message:"Turn time limit reached"})}else e.turnTimeElapsed+=1e3}),1e3)}},{key:"onTick",value:function(){}},{key:"onEnd",value:function(e){if(this.gameState=GameState.ENDED,clearInterval(this.gameTimer),clearInterval(this.turnTimer),e)return console.log("reason",_objectSpread({},e)),e}},{key:"makePlay",value:function(e){var t=e.player,r=e.position,i=e.isAI,n=e.aiDifficulty;if(this.gameState===GameState.RUNNING){if(i&&(r=this.aiBrain.getMove({board:this.board,aiPiece:t,aiDifficulty:n})),this.nextTurnPiece!==t)return this.onEnd({isValid:!1,winner:null,message:"Piece could not be placed: no consecutive turns allowed."});if(this.nextTurnPiece=this.nextTurnPiece===GamePiece.X?GamePiece.O:GamePiece.X,!this.board.placePiece({player:t,position:r}))return this.onEnd({isValid:!1,winner:null,message:"Piece could not be placed: slot filled or index out of bounds."});this.board.print(),this.playList.push({player:t,position:r,isAI:i,aiDifficulty:n});var o=this.umpire.getDecision({board:this.board,player:t,position:r});return o.verdict?this.onEnd(o):(this.turnTimeElapsed=0,_objectSpread({isValid:!0,board:this.board,nextTurnPiece:this.nextTurnPiece},o))}}},{key:"timeMsToS",value:function(e){return e/1e3}},{key:"timeSToMs",value:function(e){return 1e3*e}}]),e}();const src_TicTacToe=TicTacToe;function src_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Game=function e(){src_classCallCheck(this,e),this.TicTacToe=src_TicTacToe},game=new Game;const src=null;